<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ± - Ù†Ø´Ø± Ù…Ù†ØªØ¬</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .centered-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 100px 20px 40px;
        }
        .form-container {
            width: 100%;
            max-width: 600px;
        }
    </style>
</head>
<body class="add-product-body">
    <div class="page-bg">
        <div class="bg-pattern"></div>
    </div>

    <nav class="navbar">
        <a href="/dashboard" class="back-btn">
            <i class="fas fa-arrow-right"></i>
            <span>Ø±Ø¬ÙˆØ¹</span>
        </a>
        <div class="nav-title">Ù†Ø´Ø± Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</div>
        <div class="nav-spacer"></div>
    </nav>

    <div class="centered-container">
        <div class="form-container">
            <div class="form-header">
                <div class="form-icon"><i class="fas fa-plus-circle"></i></div>
                <h1>Ø£Ø¶Ù Ù…Ù†ØªØ¬Ùƒ Ù„Ù„Ø¨ÙŠØ¹</h1>
                <p>Ø§Ù…Ù„Ø£ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù†Ø´Ø± Ù…Ù†ØªØ¬Ùƒ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚</p>
            </div>

            <form id="addProductForm" class="product-form">
                <div class="image-upload-section">
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="productImage" accept="image/*" hidden>
                        <div class="upload-placeholder">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Ø§Ø¶ØºØ· Ø£Ùˆ Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§</span>
                            <small>PNG, JPG Ø­ØªÙ‰ 5MB</small>
                        </div>
                        <div class="upload-preview hidden" id="imagePreview">
                            <img src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ØªØ¬">
                            <button type="button" class="remove-image" onclick="removeImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-tag"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h3>
                    
                    <div class="form-row">
                        <div class="input-group floating">
                            <input type="text" id="productName" required placeholder=" ">
                            <label for="productName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                            <i class="fas fa-box input-icon"></i>
                        </div>
                    </div>

                    <div class="form-row two-cols">
                        <div class="input-group floating">
                            <input type="number" id="productPrice" required placeholder=" " min="0" step="0.01">
                            <label for="productPrice">Ø§Ù„Ø³Ø¹Ø± *</label>
                            <i class="fas fa-money-bill-wave input-icon"></i>
                        </div>
                        
                        <div class="input-group floating select-group">
                            <select id="productCurrency" required>
                                <option value="SAR">ğŸ‡¸ğŸ‡¦ Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="SDG">ğŸ‡¸ğŸ‡© Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ (SDG)</option>
                                <option value="USD">ğŸ‡ºğŸ‡¸ Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ğŸ‡ªğŸ‡º ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="GBP">ğŸ‡¬ğŸ‡§ Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ (GBP)</option>
                                <option value="AED">ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ (AED)</option>
                                <option value="KWD">ğŸ‡°ğŸ‡¼ Ø¯ÙŠÙ†Ø§Ø± ÙƒÙˆÙŠØªÙŠ (KWD)</option>
                                <option value="QAR">ğŸ‡¶ğŸ‡¦ Ø±ÙŠØ§Ù„ Ù‚Ø·Ø±ÙŠ (QAR)</option>
                                <option value="EGP">ğŸ‡ªğŸ‡¬ Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                            </select>
                            <i class="fas fa-coins input-icon"></i>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="input-group floating">
                            <select id="productCategory" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
                                <option value="electronics">ğŸ“± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                                <option value="cars">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</option>
                                <option value="fashion">ğŸ‘• Ø£Ø²ÙŠØ§Ø¡ ÙˆÙ…ÙˆØ¶Ø©</option>
                                <option value="home">ğŸ  Ù…Ù†Ø²Ù„ ÙˆØ£Ø«Ø§Ø«</option>
                                <option value="sports">âš½ Ø±ÙŠØ§Ø¶Ø© ÙˆÙ„ÙŠØ§Ù‚Ø©</option>
                                <option value="books">ğŸ“š ÙƒØªØ¨ ÙˆÙ‚Ø±Ø·Ø§Ø³ÙŠØ©</option>
                                <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                            </select>
                            <label for="productCategory">Ø§Ù„ØªØµÙ†ÙŠÙ *</label>
                            <i class="fas fa-folder input-icon"></i>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="input-group floating textarea-group">
                            <textarea id="productDescription" rows="3" placeholder=" "></textarea>
                            <label for="productDescription">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                            <i class="fas fa-align-right input-icon"></i>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</h3>
                    
                    <div class="form-row">
                        <div class="input-group floating">
                            <input type="url" id="facebookLink" placeholder=" ">
                            <label for="facebookLink"><i class="fab fa-facebook"></i> Ø±Ø§Ø¨Ø· Ø­Ø³Ø§Ø¨ Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ Ù„Ù„ØªÙˆØ§ØµÙ„</label>
                            <i class="fas fa-link input-icon"></i>
                        </div>
                    </div>

                    <div class="form-row two-cols">
                        <div class="input-group floating">
                            <select id="productCountry" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ *</option>
                                <option value="sa">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                                <option value="sd">ğŸ‡¸ğŸ‡© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
                                <option value="ae">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
                                <option value="kw">ğŸ‡°ğŸ‡¼ Ø§Ù„ÙƒÙˆÙŠØª</option>
                                <option value="qa">ğŸ‡¶ğŸ‡¦ Ù‚Ø·Ø±</option>
                                <option value="bh">ğŸ‡§ğŸ‡­ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
                                <option value="om">ğŸ‡´ğŸ‡² Ø¹Ù…Ø§Ù†</option>
                                <option value="eg">ğŸ‡ªğŸ‡¬ Ù…ØµØ±</option>
                                <option value="jo">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù†</option>
                                <option value="other">ğŸŒ Ø¯ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰</option>
                            </select>
                            <i class="fas fa-globe input-icon"></i>
                        </div>
                        
                        <div class="input-group floating">
                            <input type="text" id="productCity" required placeholder=" ">
                            <label for="productCity">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
                            <i class="fas fa-city input-icon"></i>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="input-group floating">
                            <input type="tel" id="contactPhone" placeholder=" ">
                            <label for="contactPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <i class="fas fa-phone input-icon"></i>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="window.location.href='/dashboard'">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn-primary">
                        <span>Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</span>
                        <i class="fas fa-paper-plane"></i>
                        <div class="btn-shine"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const user = JSON.parse(sessionStorage.getItem('user') || localStorage.getItem('user') || 'null');
    if (!user) {
        window.location.href = '/';
        return;
    }
    initImageUpload();
    
    document.getElementById('addProductForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('productName').value;
        const price = document.getElementById('productPrice')..getItem('user') || localStorage.getItem('user') || 'null');
    if (!user) {
        window.location.href = '/';
        return;
    }
    initImageUpload();
    
    document.getElementById('addProductForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('productName').value;
        const price = document.getElementById('productPrice').value;
        const currency = document.getElementById('productCurrency').value;
        const category = document.getElementById('productCategory').value;
        const description = document.getElementById('productDescription').value;
        const facebookLink = document.getElementById('facebookLink').value;
        const country = document.getElementById('productCountry').value;
        const city = document.getElementById('productCity').value;
        const phone = document.getElementById('contactPhone').value;
        
        if (!name || !price || !currency || !category || !country || !city) {
            showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
            return;
        }
        
        const imagePreview = document.querySelector('#imagePreview img');
        const image = imagePreview ? imagePreview.src : null;
        
        const product = {
            name, price: parseFloat(price), currency, category,
            description, facebookLink, country, city, phone, image,
            seller: user
        };
        
        const btn = this.querySelector('.btn-primary');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
        btn.disabled = true;
        
        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(product)
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                setTimeout(() => window.location.href = '/dashboard', 1500);
            } else {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬', 'error');
                btn.innerHTML = '<span>Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</span><i class="fas fa-paper-plane"></i><div class="btn-shine"></div>';
                btn.disabled = false;
            }
        } catch (error) {
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
            btn.innerHTML = '<span>Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</span><i class="fas fa-paper-plane"></i><div class="btn-shine"></div>';
            btn.disabled = false;
        }
    });
});

function initImageUpload() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('productImage');
    
    if (!uploadArea || !fileInput) return;
    
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
            handleImageFile(e.dataTransfer.files[0]);
        }
    });
    
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleImageFile(e.target.files[0]);
        }
    });
}

function handleImageFile(file) {
    if (!file.type.startsWith('image/')) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ­ÙŠØ­', 'error');
        return;
    }
    if (file.size > 5 * 1024 * 1024) {
        showNotification('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'error');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        const preview = document.getElementById('imagePreview');
        const placeholder = document.querySelector('.upload-placeholder');
        preview.querySelector('img').src = e.target.result;
        preview.classList.remove('hidden');
        placeholder.style.display = 'none';
    };
    reader.readAsDataURL(file);
}

function removeImage() {
    document.getElementById('imagePreview').classList.add('hidden');
    document.querySelector('.upload-placeholder').style.display = 'block';
    document.getElementById('productImage').value = '';
}

function showNotification(message, type = 'info') {
    const existing = document.querySelectorAll('.notification');
    existing.forEach(n => n.remove());
    
    const notification = document.createElement('div');
    const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', info: 'fa-info-circle' };
    const colors = { success: '#10b981', error: '#ef4444', info: '#3b82f6' };
    
    notification.innerHTML = `<i class="fas ${icons[type]}"></i><span>${message}</span>`;
    notification.style.cssText = `
        position: fixed; top: 20px; left: 50%;
        transform: translateX(-50%) translateY(-100px);
        background: rgba(15, 23, 42, 0.95); color: white;
        padding: 16px 24px; border-radius: 12px;
        display: flex; align-items: center; gap: 12px;
        font-weight: 600; z-index: 10000;
        border: 1px solid ${colors[type]};
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        transition: transform 0.3s ease;
    `;
    notification.querySelector('i').style.color = colors[type];
    document.body.appendChild(notification);
    
    setTimeout(() => notification.style.transform = 'translateX(-50%) translateY(0)', 100);
    setTimeout(() => {
        notification.style.transform = 'translateX(-50%) translateY(-100px)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
</body>
</html>
