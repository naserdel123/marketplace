<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณูู ุงูุฃุณุงุทูุฑ - ุงูููุชุฌุงุช</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-body">
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-store"></i>
            <span>ุณูู ุงูุฃุณุงุทูุฑ</span>
        </div>
        
        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" placeholder="ุงุจุญุซ ุนู ููุชุฌ...">
                <div class="search-filters">
                    <select id="countryFilter">
                        <option value="">ุฌููุน ุงูุจูุฏุงู</option>
                        <option value="sa">๐ธ๐ฆ ุงูุณุนูุฏูุฉ</option>
                        <option value="ae">๐ฆ๐ช ุงูุฅูุงุฑุงุช</option>
                        <option value="kw">๐ฐ๐ผ ุงููููุช</option>
                        <option value="qa">๐ถ๐ฆ ูุทุฑ</option>
                        <option value="bh">๐ง๐ญ ุงูุจุญุฑูู</option>
                        <option value="om">๐ด๐ฒ ุนูุงู</option>
                        <option value="eg">๐ช๐ฌ ูุตุฑ</option>
                        <option value="sd">๐ธ๐ฉ ุงูุณูุฏุงู</option>
                        <option value="jo">๐ฏ๐ด ุงูุฃุฑุฏู</option>
                        <option value="iq">๐ฎ๐ถ ุงูุนุฑุงู</option>
                        <option value="sy">๐ธ๐พ ุณูุฑูุง</option>
                        <option value="lb">๐ฑ๐ง ูุจูุงู</option>
                        <option value="ye">๐พ๐ช ุงูููู</option>
                        <option value="ma">๐ฒ๐ฆ ุงููุบุฑุจ</option>
                        <option value="tn">๐น๐ณ ุชููุณ</option>
                        <option value="dz">๐ฉ๐ฟ ุงูุฌุฒุงุฆุฑ</option>
                        <option value="ly">๐ฑ๐พ ููุจูุง</option>
                        <option value="ps">๐ต๐ธ ููุณุทูู</option>
                        <option value="us">๐บ๐ธ ุฃูุฑููุง</option>
                        <option value="uk">๐ฌ๐ง ุจุฑูุทุงููุง</option>
                        <option value="tr">๐น๐ท ุชุฑููุง</option>
                        <option value="other">๐ ุฏูู ุฃุฎุฑู</option>
                    </select>
                    <input type="text" id="cityFilter" placeholder="ุงููุฏููุฉ...">
                </div>
                <button class="search-btn" onclick="searchProducts()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div class="nav-menu">
            <button class="menu-dots" onclick="toggleMenu()">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            
            <div class="dropdown-menu" id="userMenu">
                <a href="#" class="menu-item" onclick="showProfile()">
                    <div class="menu-icon"><i class="fas fa-user-circle"></i></div>
                    <div class="menu-info">
                        <span class="menu-title">ุงูููู ุงูุดุฎุตู</span>
                        <span class="menu-desc">ุนุฑุถ ูุชุนุฏูู ุจูุงูุงุชู</span>
                    </div>
                </a>
                
                <a href="#" class="menu-item" onclick="showHelp()">
                    <div class="menu-icon"><i class="fas fa-question-circle"></i></div>
                    <div class="menu-info">
                        <span class="menu-title">ุงููุณุงุนุฏุฉ</span>
                        <span class="menu-desc">ูุฑูุฒ ุงููุณุงุนุฏุฉ ูุงูุฏุนู</span>
                    </div>
                </a>
                
                <div class="menu-divider"></div>
                
                <a href="/add-product" class="menu-item highlight">
                    <div class="menu-icon"><i class="fas fa-plus-circle"></i></div>
                    <div class="menu-info">
                        <span class="menu-title">ูุดุฑ ููุชุฌ</span>
                        <span class="menu-desc">ุฃุถู ููุชุฌู ููุจูุน</span>
                    </div>
                </a>
                
                <div class="menu-divider"></div>
                
                <a href="#" class="menu-item logout" onclick="logout()">
                    <div class="menu-icon"><i class="fas fa-sign-out-alt"></i></div>
                    <div class="menu-info">
                        <span class="menu-title">ุชุณุฌูู ุงูุฎุฑูุฌ</span>
                        <span class="menu-desc">ุงูุฎุฑูุฌ ูู ุงูุญุณุงุจ</span>
                    </div>
                </a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="welcome-section">
            <h1>ุฃููุงู ุจู ูู <span class="highlight-text">ุณูู ุงูุฃุณุงุทูุฑ</span> ๐</h1>
            <p>ุงูุชุดู ุฃูุถู ุงูููุชุฌุงุช ูู ุงูุจุงุฆุนูู ุงูููุซูููู</p>
        </div>

        <div class="quick-filters">
            <button class="filter-chip active" onclick="filterBy('all')">ุงููู</button>
            <button class="filter-chip" onclick="filterBy('electronics')">๐ฑ ุฅููุชุฑูููุงุช</button>
            <button class="filter-chip" onclick="filterBy('cars')">๐ ุณูุงุฑุงุช</button>
            <button class="filter-chip" onclick="filterBy('fashion')">๐ ุฃุฒูุงุก</button>
            <button class="filter-chip" onclick="filterBy('home')">๐ ููุฒู</button>
            <button class="filter-chip" onclick="filterBy('sports')">โฝ ุฑูุงุถุฉ</button>
            <button class="filter-chip" onclick="filterBy('books')">๐ ูุชุจ</button>
        </div>

        <div class="products-grid" id="productsGrid"></div>

        <div class="no-products" id="noProducts">
            <div class="no-products-icon"><i class="fas fa-store"></i></div>
            <h3>ูุง ุชูุฌุฏ ููุชุฌุงุช ุญุงููุงู</h3>
            <p>ูู ุฃูู ูู ููุดุฑ ููุชุฌ ูู ุงูุณูู!</p>
            <a href="/add-product" class="btn-primary" style="display: inline-flex; margin-top: 20px; text-decoration: none;">
                <i class="fas fa-plus"></i> ูุดุฑ ููุชุฌ ุงูุขู
            </a>
        </div>
    </main>

    <a href="/add-product" class="fab-btn" title="ูุดุฑ ููุชุฌ ุฌุฏูุฏ">
        <i class="fas fa-plus"></i>
        <span class="fab-tooltip">ูุดุฑ ููุชุฌ</span>
    </a>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const user = JSON.parse(sessionStorage.getItem('user') || localStorage.getItem('user') || 'null');
    if (!user) {
        window.location.href = '/';
        return;
    }
    loadProducts();
    setupSearchListeners();
});

async function loadProducts() {
    try {
        const response = await fetch('/api/products');
        const products = await response.json();
        renderProducts(products);
    } catch (error) {
        console.error('Error:', error);
    }
}

function renderProducts(products) {
    const grid = document.getElementById('productsGrid');
    const noProducts = document.getElementById('noProducts');
    
    if (products.length === 0) {
        grid.innerHTML = '';
        noProducts.style.display = 'block';
        return;
    }
    
    noProducts.style.display = 'none';
    
    const currencySymbols = {
        'SAR': 'ุฑ.ุณ', 'USD': '$', 'EUR': 'โฌ', 'GBP': 'ยฃ',
        'AED': 'ุฏ.ุฅ', 'KWD': 'ุฏ.ู', 'QAR': 'ุฑ.ู', 'BHD': 'ุฏ.ุจ',
        'OMR': 'ุฑ.ุน', 'JOD': 'ุฏ.ุฃ', 'EGP': 'ุฌ.ู', 'SDG': 'ุฌ.ุณ'
    };
    
    const countryNames = {
        'sa': 'ุงูุณุนูุฏูุฉ', 'ae': 'ุงูุฅูุงุฑุงุช', 'kw': 'ุงููููุช',
        'qa': 'ูุทุฑ', 'bh': 'ุงูุจุญุฑูู', 'om': 'ุนูุงู',
        'eg': 'ูุตุฑ', 'sd': 'ุงูุณูุฏุงู', 'jo': 'ุงูุฃุฑุฏู'
    };
    
    const categories = {
        'electronics': 'ุฅููุชุฑูููุงุช', 'cars': 'ุณูุงุฑุงุช',
        'fashion': 'ุฃุฒูุงุก', 'home': 'ููุฒู',
        'sports': 'ุฑูุงุถุฉ', 'books': 'ูุชุจ'
    };
    
    grid.innerHTML = products.map((product, index) => `
        <div class="product-card" style="animation: fadeInUp 0.5s ease-out ${index * 0.1}s both">
            <div class="product-image">
                <img src="${product.image || 'https://via.placeholder.com/400x300?text=No+Image'}" alt="${product.name}">
                <span class="product-badge">${categories[product.category] || product.category}</span>
            </div>
            <div class="product-info">
                <h3 class="product-title">${product.name}</h3>
                <div class="product-meta">
                    <span><i class="fas fa-map-marker-alt"></i> ${countryNames[product.country] || product.country} - ${product.city}</span>
                </div>
                <div class="product-price">
                    ${product.price.toLocaleString()} ${currencySymbols[product.currency] || product.currency}
                </div>
                <div class="product-footer">
                    <div class="seller-info">
                        <div class="seller-avatar">${product.seller?.name ? product.seller.name[0].toUpperCase() : 'U'}</div>
                        <span class="seller-name">${product.seller?.name || 'ูุณุชุฎุฏู'}</span>
                    </div>
                    ${product.facebookLink ? `
                        <a href="${product.facebookLink}" target="_blank" class="contact-btn" onclick="event.stopPropagation()">
                            <i class="fab fa-facebook"></i> ุชูุงุตู
                        </a>
                    ` : ''}
                </div>
            </div>
        </div>
    `).join('');
}

function setupSearchListeners() {
    document.getElementById('searchInput')?.addEventListener('input', debounce(filterProducts, 300));
    document.getElementById('countryFilter')?.addEventListener('change', filterProducts);
    document.getElementById('cityFilter')?.addEventListener('input', debounce(filterProducts, 300));
}

async function filterProducts() {
    const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
    const country = document.getElementById('countryFilter')?.value || '';
    const city = document.getElementById('cityFilter')?.value.toLowerCase() || '';
    
    try {
        const response = await fetch('/api/products');
        let products = await response.json();
        
        if (searchTerm) products = products.filter(p => p.name.toLowerCase().includes(searchTerm));
        if (country) products = products.filter(p => p.country === country);
        if (city) products = products.filter(p => p.city.toLowerCase().includes(city));
        
        renderProducts(products);
    } catch (error) {
        console.error('Error:', error);
    }
}

function filterBy(category) {
    document.querySelectorAll('.filter-chip').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    fetch('/api/products')
        .then(r => r.json())
        .then(products => {
            if (category !== 'all') products = products.filter(p => p.category === category);
            renderProducts(products);
        });
}

function toggleMenu() {
    document.getElementById('userMenu').classList.toggle('active');
}

document.addEventListener('click', function(e) {
    const menu = document.getElementById('userMenu');
    const menuBtn = document.querySelector('.menu-dots');
    if (menu && !menu.contains(e.target) && !menuBtn?.contains(e.target)) {
        menu.classList.remove('active');
    }
});

function showProfile() {
    const user = JSON.parse(sessionStorage.getItem('user') || localStorage.getItem('user') || '{}');
    showNotification(`ูุฑุญุจุงู ${user.name || ''}!`, 'info');
}

function showHelp() {
    showNotification('ูุฑูุฒ ุงููุณุงุนุฏุฉ ูุฑูุจุงู!', 'info');
}

function logout() {
    localStorage.removeItem('user');
    sessionStorage.removeItem('user');
    showNotification('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ', 'success');
    setTimeout(() => window.location.href = '/', 1000);
}

function debounce(func, wait) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), wait);
    };
}

function showNotification(message, type = 'info') {
    const existing = document.querySelectorAll('.notification');
    existing.forEach(n => n.remove());
    
    const notification = document.createElement('div');
    const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', info: 'fa-info-circle' };
    const colors = { success: '#10b981', error: '#ef4444', info: '#3b82f6' };
    
    notification.innerHTML = `<i class="fas ${icons[type]}"></i><span>${message}</span>`;
    notification.style.cssText = `
        position: fixed; top: 20px; left: 50%;
        transform: translateX(-50%) translateY(-100px);
        background: rgba(15, 23, 42, 0.95); color: white;
        padding: 16px 24px; border-radius: 12px;
        display: flex; align-items: center; gap: 12px;
        font-weight: 600; z-index: 10000;
        border: 1px solid ${colors[type]};
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        transition: transform 0.3s ease;
    `;
    notification.querySelector('i').style.color = colors[type];
    document.body.appendChild(notification);
    
    setTimeout(() => notification.style.transform = 'translateX(-50%) translateY(0)', 100);
    setTimeout(() => {
        notification.style.transform = 'translateX(-50%) translateY(-100px)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
</body>
          </html>
          
